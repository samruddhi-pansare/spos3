#include <iostream>
#include <map>
#include <vector>
#include <string>
#include <sstream>
using namespace std;

// --------------------- MAIN PROGRAM ---------------------
int main() {
    // SYMBOL TABLE
    map<string, int> SYMTAB = {
        {"X", 214}, {"L1", 202}, {"NEXT", 207}, {"BACK", 202}
    };

    // LITERAL TABLE
    map<int, pair<string, int>> LITTAB = {
        {1, {"='5'", 205}},
        {2, {"='2'", 206}},
        {3, {"='1'", 210}},
        {4, {"='2'", 211}},
        {5, {"='4'", 215}}
    };

    // INTERMEDIATE CODE
    vector<string> IC = {
        "(AD,01) (C,200)",
        "(IS,04) 1 (L,1)",
        "(IS,05) 1 (S,1)",
        "(IS,04) 2 (L,2)",
        "(AD,03) (S,2)+3",
        "(AD,05)",
        "(L,1)",
        "(L,2)",
        "(IS,01) 1 (L,3)",
        "(IS,02) 2 (L,4)",
        "(IS,07) 1 (S,4)",
        "(AD,05)",
        "(L,3)",
        "(L,4)",
        "(AD,04) (S,2)",
        "(IS,03) 3 (L,5)",
        "(IS,00)",
        "(DL,02) (C,1)",
        "(AD,02)"
    };

    cout << "PASS-II of Two Pass Assembler\n";
    cout << "Generated Machine Code:\n";
    cout << "----------------------------\n";

    for (string line : IC) {
        stringstream ss(line);
        string part;
        ss >> part;

        // Ignore Assembler Directives
        if (part.find("(AD") != string::npos) continue;
        if (part.find("(DL") != string::npos) continue;

        // Handle Imperative Statements (IS)
        if (part.find("(IS") != string::npos) {
            string opcode = part.substr(4, 2); // extract opcode number
            string reg, addrType, addrVal;
            ss >> reg >> addrType;

            if (addrType.find("(L,") != string::npos) {
                // Literal
                int litIndex = addrType[3] - '0';
                cout << "IS=" << opcode << "  REG=" << reg
                     << "  MEM=" << LITTAB[litIndex].second << endl;
            } 
            else if (addrType.find("(S,") != string::npos) {
                // Symbol
                int symIndex = addrType[3] - '0';
                int i = 1;
                for (auto s : SYMTAB) {
                    if (i == symIndex)
                        cout << "IS=" << opcode << "  REG=" << reg
                             << "  MEM=" << s.second << endl;
                    i++;
                }
            } 
            else if (part.find("(IS,00)") != string::npos) {
                // STOP instruction
                cout << "IS=00  --STOP--\n";
            }
        }
    }

    return 0;
}
